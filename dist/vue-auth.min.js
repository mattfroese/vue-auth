/**
  * vue-auth v0.1.1
  * (c) 2017 Matt Froese
  * @license MIT
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueAuth=t()}(this,function(){"use strict";function e(e){var t={};return void 0!==e.status?(t.code=e.status,t.error=e.statusText,t.data=e.data?e.data.errors:null,t.http=e,t.message=r(t),401==t.code&&t.http.headers.get("X-Authentication-Location")&&(t.redirect=t.http.headers.get("X-Authentication-Location"))):"string"==typeof e?(t.code=-1,t.message=e,t.error=e,t.http=null):(t.code=-1,t.message=e.message,t.error=e.message,t.http=null),console.error("[Auth Error]",t),Promise.reject(t)}function t(e){var t=e.split(".")[1],r=DanaMethodReplace("replace",DanaMethodReplace("replace",t,"-","+"),"_","/");return JSON.parse(window.atob(r))}function r(e){return"Connection Issue"==e.error?"Could not connect":"Bad Request"==e.error?"Invalid data":"Token Expired"==e.error?"Token Expired":500==e.code?"Server Error":404==e.code?"Not Found":403==e.code?"Forbidden":401==e.code?"Unauthorized":"Unknown error"}var n={defaults:{base:"/api/",scope:null,unauthorized_location:null,access_token:"token",refresh_token:"refresh",endpoints:{login:"login",logout:"logout",refresh:"refresh"}},install:function(r,o){if(!n.installed){var u=new r({data:{token_type:!1,refresh_token:null,access_token:null,expires:null,user:null,not_before:null,issued_at:null,loading:!1,checking:!1,expiry_timer:null},computed:{expires_in:function(){return!!this.expires&&1e3*this.expires-Date.now()}}}),i=r.prototype.$auth=u,s=Object.assign(n.defaults,o),a=r.http,c=o.router;a||console.error("Auth requires vue-resource. Make sure you Vue.use(VueResource) before Vue.use(Auth)"),c?c.beforeEach(function(e,t,r){var n=s.router.app.$auth;e.meta.auth&&null===n.user?n.authenticate().then(function(){r()},function(e){e.redirect&&(window.location.href=e.redirect),s.unauthorized_location&&r({path:s.unauthorized_location})}):r()}):console.info(c,"To use with vue-router, pass it to me Vue.use(Auth< {router})"),window.onfocus=function(){i.attemptRefresh()},i.uri=function(e){return s.base+s.endpoints[e]},i.authenticate=function(){var e={};return s.scope&&(e.scope=s.scope),s.redirect&&(e.redirect=s.redirect),i.attachRequestQuarterback(a.get(this.uri("login"),{credentials:!0,params:e}))},i.refresh=function(){return i.attachRequestQuarterback(a.post(this.uri("refresh"),{token:i.refresh_token}))},i.logout=function(){return i.refresh_token=null,i.access_token=null,i.user=null,i.expires=null,i.issued_at=null,i.not_before=null,Promise.resolve()},i.attachRequestQuarterback=function(t){return i.loading=!0,t.then(function(e){return i.receivethMightyToken(e.data),Promise.resolve()}).catch(function(t){return e(t)}).finally(function(){i.loading=!1})},i.receivethMightyToken=function(r){var n=r[s.access_token],o=r[s.refresh_token];if(void 0==n)return e("No token received");var u=t(n);i.access_token=n,i.user=r.payload,i.expires=u.exp,i.issued_at=u.iat,i.not_before=u.nbf,i.refresh_token=o,i.attemptRefreshIn(i.expires_in-3e4)},i.attemptRefreshIn=function(e){clearTimeout(i.expiry_timer),i.expiry_timer=setTimeout(function(){i.attemptRefresh()},e)},i.attemptRefresh=function(){var e=1e3*i.expires-Date.now();console.info("attemptRefresh"),console.info(new Date),console.info("Expires in:",e),console.info("Refresh Token:",i.refresh_token?"set":"not set"),i.refresh_token&&e<=3e5&&i.authenticate().catch(function(e){clearInterval(i.expiry_timer)})}}}};return n});